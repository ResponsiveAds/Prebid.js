<!--
This page demonstrates how to use a custom resizeFn in Prebid.js adUnits configuration.

The customResizeFn property can be defined on any adUnit and will be called when an ad needs to be resized.
This is particularly useful for responsive ads that need custom resize behavior.

The custom resize function receives four parameters:
- width: The new width for the ad
- height: The new height for the ad  
- frame: The iframe element containing the ad (may be null)
- doc: The document object where the ad is rendered

This example shows how to:
1. Define a customResizeFn in the adUnits array
2. Apply custom styling and resize logic
3. Log resize events for debugging
4. Fall back to default behavior if the custom function fails

NOTE that many ad servers won't send back an ad if the URL is localhost... so you might need to
set an alias in your /etc/hosts file so that you can load this page from a different domain.
-->

<html>

<head>
    <script async src="../../build/dev/prebid.js"></script>
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script>
        var FAILSAFE_TIMEOUT = 3300;
        var PREBID_TIMEOUT = 1000;
        
        var adUnits = [{
            code: 'div-gpt-ad-1460505748561-0',
            mediaTypes: {
                banner: {
                    sizes: [[300, 250]],
                }
            },
            
            // Custom resize function for this adUnit
            customResizeFn: function(width, height, frame, doc) {
                console.log('Custom resize function called');
                console.log('Resize dimensions:', width, 'x', height);
                
                // Custom resize logic - stretch container to 100% screen width
                if (frame) {
                    // Set height to maintain original dimensions and prevent page jumping
                    if (height) {
                        frame.height = height;
                        frame.style.height = height + 'px';
                    }
                    
                    // Stretch the frame to 100% width of the viewport
                    frame.style.width = '100vw';
                    frame.style.maxWidth = '100vw';
                    frame.width = window.innerWidth || document.documentElement.clientWidth;
                    
                    // Position the frame to break out of its container
                    frame.style.position = 'relative';
                    frame.style.left = '50%';
                    frame.style.transform = 'translateX(-50%)';
                    
                    // Add custom styling
                    frame.style.border = '2px solid blue';
                    frame.style.borderRadius = '8px';
                    frame.style.boxSizing = 'border-box';
                    
                    // Style the container to accommodate the stretched ad
                    if (frame.parentElement) {
                        frame.parentElement.style.overflow = 'visible';
                        frame.parentElement.style.position = 'relative';
                        frame.parentElement.style.backgroundColor = '#f0f0f0';
                    }
                    
                    // Log to parent window for debugging
                    if (window.parent && window.parent !== window) {
                        window.parent.console.log('Ad resized to full width with height:', height, 'px');
                    }
                }
            },
            
            // Replace this object to test a new Adapter!
            bids: [{
                bidder: 'adnuntius',
                params: {
                    auId: "201208",
                    network: "1287",
                    bidType: 'netBid'
                }
            }]
        }];
        
        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];
        
    </script>
    
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
        googletag.cmd.push(function () {
            googletag.pubads().disableInitialLoad();
        });
        
        pbjs.que.push(function () {
            pbjs.addAdUnits(adUnits);
            
            pbjs.requestBids({
                bidsBackHandler: sendAdserverRequest,
                timeout: PREBID_TIMEOUT
            });
        });
        
        function sendAdserverRequest() {
            if (pbjs.adserverRequestSent) return;
            pbjs.adserverRequestSent = true;
            googletag.cmd.push(function () {
                if (pbjs.libLoaded) {
                    pbjs.que.push(function () {
                        pbjs.setTargetingForGPTAsync();
                        googletag.pubads().refresh();
                    });
                } else {
                    googletag.pubads().refresh();
                }
            });
        }
        
        setTimeout(function () {
            sendAdserverRequest();
        }, FAILSAFE_TIMEOUT);
        
    </script>
    
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], 'div-gpt-ad-1460505748561-0').addService(googletag.pubads());
            
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
</head>

<body>
    <h2>Prebid.js Test - Custom ResizeFn Demo</h2>
    <p>This example demonstrates a custom resize function that adds styling and logging when ads are resized.</p>
    <h5>Div-1 (with custom resizeFn)</h5>
    <div id='div-gpt-ad-1460505748561-0'>
        <script type='text/javascript'>
            googletag.cmd.push(function () { googletag.display('div-gpt-ad-1460505748561-0'); });
        </script>
    </div>
</body>

</html>
